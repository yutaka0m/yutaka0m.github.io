<!doctype html><html lang=jp-ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=hugo-theme content="Axiom 0.7.0"><link rel=icon href=https://resources.yutaka0m.com/favicon.ico><link rel=apple-touch-icon href=/image/brand/icon-1-1.jpg><link rel=canonical href=https://tech.yutaka0m.com/entry/2020/03/17/112/><link rel=preload as=style href="/bundle.css?v=1613303645" media=all><link rel=stylesheet href="/bundle.css?v=1613303645" media=all><style>.cdata pre{color:#edf2f7;background-color:#2d3748}.cdata :not(pre)>code{color:#805ad5;background-color:#f7fafc}.chroma .err{color:#fed7d7;background-color:#9b2c2c}.chroma .hl{background-color:#4a5568}.chroma .ln{color:#a0aec0}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#63b3ed}.chroma .kt{color:#b794f4}.chroma .na{color:#f6e05e}.chroma .nb{color:#f6ad55}.chroma .nc{color:#fc8181}.chroma .no{color:#68d391}.chroma .nd{color:#fc8181}.chroma .ne{color:#fc8181}.chroma .nf{color:#f6ad55}.chroma .nt{color:#fc8181}.chroma .l{color:#b794f4}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#68d391}.chroma .se{color:#a0aec0}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#68d391}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#b794f4}.chroma .o,.chroma .ow{color:#90cdf4}.chroma .p{color:#cbd5e0}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs{color:#a0aec0}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}</style><title>PythonフォーマットをIntelliJとGitHub Actionsで自動化する (black/isort/flake8/pytest) : yutaka0m blog</title><meta property="og:title" content="PythonフォーマットをIntelliJとGitHub Actionsで自動化する (black/isort/flake8/pytest)"><meta property="og:site_name" content="yutaka0m blog"><meta property="og:url" content="https://tech.yutaka0m.com/entry/2020/03/17/112/"><link rel=image_src href=https://tech.yutaka0m.com/image/top-image.jpg><meta property="og:image" content="https://tech.yutaka0m.com/image/top-image.jpg"><meta property="og:image:width" content="1920"><meta property="og:image:height" content="1080"><meta property="og:type" content="article"><meta property="og:locale" content="jp_ja"><meta property="og:description" content="Pythonのコードを読みやすくするために、IntelliJにPythonのフォーマッタを導入する方法を紹介します。 また、GitHubで自動テスト(CI)できるように、GitHub Actionsの設定もおこないます。 導入するのは次のツールです。  black: コードのフォーマッタ isort: importのフォーマッタ flake8: 使用していない変数などを警告してくれます pytest: ユニットテスト  IntelliJの設定 File Watchersのインストール File Watchersは、コードの変更をトリガーにして任意のコマンドを自動で実行してくれるプラグインです。 IntelliJにて、Preferences -&amp;gt; Pluginsから「File Watchers」を検索してインストールします。 インストールが完了したら、IntelliJを再起動させます。 blackの設定 設定ファイルの作成 プロジェクトのルートディレクトリに、pyproject.tomlを作成して、次のように書きます。 [tool.black] line-length = 120 blackのインストール 次のコマンドでblackをインストールします。 pip install black which black #blackが保存されているパスが表示されるのでメモしておく IntelliJでの設定 続いてIntelliJの設定です。"><meta name=description content="Pythonのコードを読みやすくするために、IntelliJにPythonのフォーマッタを導入する方法を紹介します。 また、GitHubで自動テスト(CI)できるように、GitHub Actionsの設定もおこないます。 導入するのは次のツールです。  black: コードのフォーマッタ isort: importのフォーマッタ flake8: 使用していない変数などを警告してくれます pytest: ユニットテスト  IntelliJの設定 File Watchersのインストール File Watchersは、コードの変更をトリガーにして任意のコマンドを自動で実行してくれるプラグインです。 IntelliJにて、Preferences -&amp;gt; Pluginsから「File Watchers」を検索してインストールします。 インストールが完了したら、IntelliJを再起動させます。 blackの設定 設定ファイルの作成 プロジェクトのルートディレクトリに、pyproject.tomlを作成して、次のように書きます。 [tool.black] line-length = 120 blackのインストール 次のコマンドでblackをインストールします。 pip install black which black #blackが保存されているパスが表示されるのでメモしておく IntelliJでの設定 続いてIntelliJの設定です。"><meta property="og:updated_time" content="2020-03-17T08:16:32Z"><meta property="fb:app_id" content><meta name=author content="yutaka0m"><meta property="article:author" content="https://tech.yutaka0m.com"><meta property="article:published_time" content="2020-03-17T08:16:32Z"><meta property="article:modified_time" content="2020-03-17T08:16:32Z"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"PythonフォーマットをIntelliJとGitHub Actionsで自動化する (black/isort/flake8/pytest)","alternativeHeadline":"Pythonのコードを読みやすくするために、IntelliJにPythonのフォーマッタを導入する方法を紹介します。 また、GitHubで自動テスト(CI)できるように、GitHub Actionsの設定もおこないます。 導入するのは次のツールです。  black: コードのフォーマッタ isort: importのフォーマッタ flake8: 使用していない変数などを警告してくれます pytest: ユニットテスト  IntelliJの設定 File Watchersのインストール File Watchersは、コードの変更をトリガーにして任意のコマンドを自動で実行してくれるプラグインです。 IntelliJにて、Preferences -\u0026gt; Pluginsから「File Watchers」を検索してインストールします。 インストールが完了したら、IntelliJを再起動させます。 blackの設定 設定ファイルの作成 プロジェクトのルートディレクトリに、pyproject.tomlを作成して、次のように書きます。 [tool.black] line-length = 120 blackのインストール 次のコマンドでblackをインストールします。 pip install black which black #blackが保存されているパスが表示されるのでメモしておく IntelliJでの設定 続いてIntelliJの設定です。","url":"https://tech.yutaka0m.com/entry/2020/03/17/112/","image":"https://tech.yutaka0m.com/image/top-image.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.yutaka0m.com/entry/2020/03/17/112/"},"description":"Pythonのコードを読みやすくするために、IntelliJにPythonのフォーマッタを導入する方法を紹介します。 また、GitHubで自動テスト(CI)できるように、GitHub Actionsの設定もおこないます。 導入するのは次のツールです。  black: コードのフォーマッタ isort: importのフォーマッタ flake8: 使用していない変数などを警告してくれます pytest: ユニットテスト  IntelliJの設定 File Watchersのインストール File Watchersは、コードの変更をトリガーにして任意のコマンドを自動で実行してくれるプラグインです。 IntelliJにて、Preferences -\u0026gt; Pluginsから「File Watchers」を検索してインストールします。 インストールが完了したら、IntelliJを再起動させます。 blackの設定 設定ファイルの作成 プロジェクトのルートディレクトリに、pyproject.tomlを作成して、次のように書きます。 [tool.black] line-length = 120 blackのインストール 次のコマンドでblackをインストールします。 pip install black which black #blackが保存されているパスが表示されるのでメモしておく IntelliJでの設定 続いてIntelliJの設定です。","author":{"@type":"Person","name":"yutaka0m"},"publisher":{"@type":"Organization","name":"yutaka0m blog","logo":{"@type":"ImageObject","url":"https://tech.yutaka0m.com/image/brand/icon-1-1.jpg"}},"datePublished":"2020-03-17T08:16:32Z","dateModified":"2020-03-17T08:16:32Z","articleBody":"\u003cp\u003ePythonのコードを読みやすくするために、IntelliJにPythonのフォーマッタを導入する方法を紹介します。\u003cbr\u003e\nまた、GitHubで自動テスト(CI)できるように、GitHub Actionsの設定もおこないます。\u003c/p\u003e\n\u003cp\u003e導入するのは次のツールです。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eblack: コードのフォーマッタ\u003c/li\u003e\n\u003cli\u003eisort: importのフォーマッタ\u003c/li\u003e\n\u003cli\u003eflake8: 使用していない変数などを警告してくれます\u003c/li\u003e\n\u003cli\u003epytest: ユニットテスト\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"intellijの設定\"\u003eIntelliJの設定\u003c/h2\u003e\n\u003ch3 id=\"file-watchersのインストール\"\u003eFile Watchersのインストール\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eFile Watchers\u003c/code\u003eは、コードの変更をトリガーにして任意のコマンドを自動で実行してくれるプラグインです。\u003c/p\u003e\n\u003cp\u003eIntelliJにて、\u003ccode\u003ePreferences\u003c/code\u003e -\u0026gt; \u003ccode\u003ePlugins\u003c/code\u003eから「File Watchers」を検索してインストールします。\u003cbr\u003e\nインストールが完了したら、IntelliJを再起動させます。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://resources.yutaka0m.com/20200317161828.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"blackの設定\"\u003eblackの設定\u003c/h3\u003e\n\u003ch4 id=\"設定ファイルの作成\"\u003e設定ファイルの作成\u003c/h4\u003e\n\u003cp\u003eプロジェクトのルートディレクトリに、\u003ccode\u003epyproject.toml\u003c/code\u003eを作成して、次のように書きます。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e[tool.black]\nline-length = 120\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"blackのインストール\"\u003eblackのインストール\u003c/h4\u003e\n\u003cp\u003e次のコマンドでblackをインストールします。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epip install black\nwhich black\n#blackが保存されているパスが表示されるのでメモしておく\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"intellijでの設定\"\u003eIntelliJでの設定\u003c/h4\u003e\n\u003cp\u003e続いてIntelliJの設定です。\u003cbr\u003e\n\u003ccode\u003ePreferences\u003c/code\u003e -\u0026gt; \u003ccode\u003eTools\u003c/code\u003e -\u0026gt; \u003ccode\u003eFile Watchers\u003c/code\u003eで「+」を選択します。\u003c/p\u003e\n\u003cp\u003e設定画面が表示されるので、次のように設定します。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eName: Black\u003c/li\u003e\n\u003cli\u003eFile type: Python\u003c/li\u003e\n\u003cli\u003eScope: Project Files\u003c/li\u003e\n\u003cli\u003eProgram: \u003ccode\u003ewhich black\u003c/code\u003eで調べた、blackのパス\u003c/li\u003e\n\u003cli\u003eArguments: \u003ccode\u003e$FilePath$\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eOutput paths to refresh: \u003ccode\u003e$FilePath$\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eWorking directory: \u003ccode\u003e$ProjectFileDir$\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://resources.yutaka0m.com/20200317123154.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eこの設定によって、Pythonコードを更新するたびに\u003ccode\u003eblack\u003c/code\u003eが走り、フォーマットしてくれます。\u003c/p\u003e\n\u003ch3 id=\"isortの設定\"\u003eisortの設定\u003c/h3\u003e\n\u003ch4 id=\"設定ファイルの作成-1\"\u003e設定ファイルの作成\u003c/h4\u003e\n\u003cp\u003eプロジェクトのルートディレクトリに、\u003ccode\u003e.isort.cfg\u003c/code\u003eを作成して、次のように書きます。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e[settings]\ninclude_trailing_comma = true\nline_length = 120\nmulti_line_output = 3\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"isortのインストール\"\u003eisortのインストール\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epip install isort\nwhich isort\n#isortが保存されているパスが表示されるのでメモしておく\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"intellijでの設定-1\"\u003eIntelliJでの設定\u003c/h4\u003e\n\u003cp\u003e続いてIntelliJの設定です。\u003cbr\u003e\n\u003ccode\u003ePreferences\u003c/code\u003e -\u0026gt; \u003ccode\u003eTools\u003c/code\u003e -\u0026gt; \u003ccode\u003eFile Watchers\u003c/code\u003eで「+」を選択します。\u003c/p\u003e\n\u003cp\u003e設定画面が表示されるので、次のように設定します。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eName: isort\u003c/li\u003e\n\u003cli\u003eFile type: Python\u003c/li\u003e\n\u003cli\u003eScope: Project Files\u003c/li\u003e\n\u003cli\u003eProgram: \u003ccode\u003ewhich isort\u003c/code\u003eで調べた、isortのパス\u003c/li\u003e\n\u003cli\u003eArguments: \u003ccode\u003e$FilePath$\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eOutput paths to refresh: \u003ccode\u003e$FilePath$\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eWorking directory: \u003ccode\u003e$ProjectFileDir$\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"https://resources.yutaka0m.com/20200317124650.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"flake8の設定\"\u003eflake8の設定\u003c/h3\u003e\n\u003ch4 id=\"設定ファイルの作成-2\"\u003e設定ファイルの作成\u003c/h4\u003e\n\u003cp\u003eプロジェクトのルートディレクトリに、\u003ccode\u003e.flake8\u003c/code\u003eを作成して、次のように書きます。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e[flake8]\nignore = E501, E203, W503, W504\nmax-line-length = 120\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eflake8はGitHub Actiosのみで使用する想定なので、IntelliJの設定はしません。GitHub Actionsが\u003ccode\u003eflake8\u003c/code\u003eを実行する際に、この設定ファイルを読み込んでくれます。\u003c/p\u003e\n\u003ch2 id=\"github-actionsの設定\"\u003eGitHub Actionsの設定\u003c/h2\u003e\n\u003cp\u003eGitHub Actionsでも、Pythonコードのフォーマットが正しいかテストをします。\u003c/p\u003e\n\u003cp\u003eGitHubリポジトリで、\u003ccode\u003eActions\u003c/code\u003e -\u0026gt; \u003ccode\u003eSet up a workflow yourself\u003c/code\u003eを選択すると、GitHub Actionsの編集画面が表示されます。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://resources.yutaka0m.com/20200317163616.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eエディタに次のコードを書きます。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003ename: Python CI\non:\n  push:\njobs:\n  test:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        python-version: [3.7, 3.8]\n    steps:\n    - uses: actions/checkout@v2\n    - name: Set up Python ${{ matrix.python-version }}\n      uses: actions/setup-python@v1\n      with:\n        python-version: ${{ matrix.python-version }}\n    - name: Install dependencies\n      run: |\n        python -m pip install --upgrade pip\n        pip install -r requirements.txt\n    - name: Test with pytest\n      run: |\n        pip install pytest\n        pytest\n    - name: Test with black\n      run: |\n        pip install black\n        black --check .\n    - name: Test with flake8\n      run: |\n        pip install flake8\n        flake8 . --statistics --count --show-source\n    - name: Test with isort\n      run: |\n        pip install isort\n        isort -c\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eこのGitHub Actionsは、GitHubにpushするたび、python3.7と3.8の環境で\u003ccode\u003epytest\u003c/code\u003e, \u003ccode\u003eblack\u003c/code\u003e, \u003ccode\u003eflake8\u003c/code\u003e, \u003ccode\u003eisort\u003c/code\u003eを実行します。プロジェクトにユニットテストがない場合は、\u003ccode\u003epytest\u003c/code\u003eは不要です。\u003c/p\u003e\n\u003cp\u003eフォーマットが不正な場合は\u003ccode\u003ePull requests\u003c/code\u003eの画面にテスト失敗したことが表示されます。これでコードレビューが捗ります。\u003c/p\u003e\n\u003cp\u003eこのGitHub Actionsの設定は次のリポジトリで使っているのでご参考ください。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/yutaka0m/markdown-hiko\"\u003ehttps://github.com/yutaka0m/markdown-hiko\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"参考\"\u003e参考\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yutaka0m/markdown-hiko\"\u003ehttps://github.com/yutaka0m/markdown-hiko\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/psf/black#pycharmintellij-idea\"\u003ehttps://github.com/psf/black#pycharmintellij-idea\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://help.github.com/ja/actions/getting-started-with-github-actions/about-github-actions\"\u003ehttps://help.github.com/ja/actions/getting-started-with-github-actions/about-github-actions\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"}</script><link rel=preload as=script href="/bundle.js?v=1613303645"></head><body><header id=nav class=header><div class="ax-l-i max-w-6xl"><div class=ax-logo><a class=block href=/ title="yutaka0m blog"><span class="font-semibold text-raven-900">yutaka0m blog</span></a></div><div class=ax-user><a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target=_blank rel="noopener nofollow" href="https://www.google.com/search?q=site:https://tech.yutaka0m.com" title=Search><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33.0 002.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg></a><a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href=/entry/>記事一覧</a></div></div></header><main><div class=default-single><div class="ax-title ax-l-o"><div class="ax-l-i max-w-680"><h1 class="post-title font-content-title font-normal leading-tight tracking-default text-40">PythonフォーマットをIntelliJとGitHub Actionsで自動化する (black/isort/flake8/pytest)</h1><div class="ax-meta flex items-center mt-5"><div class="flex-grow min-w-0"><div class="flex items-center"><div class=flex-shrink-0><img class="w-12 h-12 sm:w-14 sm:h-14 object-cover p-3px rounded-full border border-blue-300" src=/image/author/default.jpg alt=yutaka0m></div><div class="flex-shrink-0 ml-2 leading-tight font-content-sans"><a class="block text-sm text-raven-800 hover:text-raven-900 hover:underline focus:underline" target=_blank rel="noopener nofollow" title=yutaka0m href=https://tech.yutaka0m.com>yutaka0m</a>
<time class="text-sm text-raven-500" datetime=2020-03-17T08:16:32Z>Mar 17, 2020 8:16AM</time></div></div></div><div><div class="flex items-center"><a class="flex-shrink-0 block text-raven-800 hover:text-raven-900" target=_blank rel="noopener nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Python%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%83%e3%83%88%e3%82%92IntelliJ%e3%81%a8GitHub%20Actions%e3%81%a7%e8%87%aa%e5%8b%95%e5%8c%96%e3%81%99%e3%82%8b%20%28black%2fisort%2fflake8%2fpytest%29%20by%20%40yutaka0m%20https%3a%2f%2ftech.yutaka0m.com%2fentry%2f2020%2f03%2f17%2f112%2f"><svg class="w-6 h-6 fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11.0 01-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56.0 00-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57.0 002.914 5.452 6.48 6.48.0 01-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42.0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18.0 01-8.134 2.798c-.538.0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072.0 18.672-10 18.672-18.668.0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a><a class="ml-3 flex-shrink-0 block text-raven-800 hover:text-raven-900" target=_blank rel="noopener nofollow" title="Share on Facebook" href="https://www.facebook.com/dialog/share?app_id=&display=page&href=https%3a%2f%2ftech.yutaka0m.com%2fentry%2f2020%2f03%2f17%2f112%2f"><svg class="w-6 h-6 fill-current" viewBox="-7 -3.5 39 39" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M30.234.0H1.765C.8.001.0.79.0 1.766v28.47C.001 31.2.79 32 1.766 32h15.328V19.625h-4.156V14.78h4.156v-3.564c0-4.134 2.523-6.384 6.21-6.384 1.766.0 3.284.13 3.726.2v4.32h-2.543c-2.006.0-2.394.953-2.394 2.352v3.085h4.797l-.625 4.844h-4.172V32h8.14C31.21 32 32 31.2 32 30.234V1.765C32 .8 31.21.0 30.234.0z"/></svg></a></div></div></div></div></div><div class="ax-content ax-l-o"><div class="ax-l-i max-w-680"><article class=cdata><p>Pythonのコードを読みやすくするために、IntelliJにPythonのフォーマッタを導入する方法を紹介します。<br>また、GitHubで自動テスト(CI)できるように、GitHub Actionsの設定もおこないます。</p><p>導入するのは次のツールです。</p><ul><li>black: コードのフォーマッタ</li><li>isort: importのフォーマッタ</li><li>flake8: 使用していない変数などを警告してくれます</li><li>pytest: ユニットテスト</li></ul><h2 id=intellijの設定>IntelliJの設定</h2><h3 id=file-watchersのインストール>File Watchersのインストール</h3><p><code>File Watchers</code>は、コードの変更をトリガーにして任意のコマンドを自動で実行してくれるプラグインです。</p><p>IntelliJにて、<code>Preferences</code> -> <code>Plugins</code>から「File Watchers」を検索してインストールします。<br>インストールが完了したら、IntelliJを再起動させます。</p><p><img src=https://resources.yutaka0m.com/20200317161828.png alt></p><h3 id=blackの設定>blackの設定</h3><h4 id=設定ファイルの作成>設定ファイルの作成</h4><p>プロジェクトのルートディレクトリに、<code>pyproject.toml</code>を作成して、次のように書きます。</p><pre><code class=language-bash>[tool.black]
line-length = 120</code></pre><h4 id=blackのインストール>blackのインストール</h4><p>次のコマンドでblackをインストールします。</p><pre><code class=language-bash>pip install black
which black
#blackが保存されているパスが表示されるのでメモしておく</code></pre><h4 id=intellijでの設定>IntelliJでの設定</h4><p>続いてIntelliJの設定です。<br><code>Preferences</code> -> <code>Tools</code> -> <code>File Watchers</code>で「+」を選択します。</p><p>設定画面が表示されるので、次のように設定します。</p><ul><li>Name: Black</li><li>File type: Python</li><li>Scope: Project Files</li><li>Program: <code>which black</code>で調べた、blackのパス</li><li>Arguments: <code>$FilePath$</code></li><li>Output paths to refresh: <code>$FilePath$</code></li><li>Working directory: <code>$ProjectFileDir$</code></li></ul><p><img src=https://resources.yutaka0m.com/20200317123154.png alt></p><p>この設定によって、Pythonコードを更新するたびに<code>black</code>が走り、フォーマットしてくれます。</p><h3 id=isortの設定>isortの設定</h3><h4 id=設定ファイルの作成-1>設定ファイルの作成</h4><p>プロジェクトのルートディレクトリに、<code>.isort.cfg</code>を作成して、次のように書きます。</p><pre><code class=language-bash>[settings]
include_trailing_comma = true
line_length = 120
multi_line_output = 3</code></pre><h4 id=isortのインストール>isortのインストール</h4><pre><code class=language-bash>pip install isort
which isort
#isortが保存されているパスが表示されるのでメモしておく</code></pre><h4 id=intellijでの設定-1>IntelliJでの設定</h4><p>続いてIntelliJの設定です。<br><code>Preferences</code> -> <code>Tools</code> -> <code>File Watchers</code>で「+」を選択します。</p><p>設定画面が表示されるので、次のように設定します。</p><ul><li>Name: isort</li><li>File type: Python</li><li>Scope: Project Files</li><li>Program: <code>which isort</code>で調べた、isortのパス</li><li>Arguments: <code>$FilePath$</code></li><li>Output paths to refresh: <code>$FilePath$</code></li><li>Working directory: <code>$ProjectFileDir$</code></li></ul><p><img src=https://resources.yutaka0m.com/20200317124650.png alt></p><h3 id=flake8の設定>flake8の設定</h3><h4 id=設定ファイルの作成-2>設定ファイルの作成</h4><p>プロジェクトのルートディレクトリに、<code>.flake8</code>を作成して、次のように書きます。</p><pre><code class=language-bash>[flake8]
ignore = E501, E203, W503, W504
max-line-length = 120</code></pre><p>flake8はGitHub Actiosのみで使用する想定なので、IntelliJの設定はしません。GitHub Actionsが<code>flake8</code>を実行する際に、この設定ファイルを読み込んでくれます。</p><h2 id=github-actionsの設定>GitHub Actionsの設定</h2><p>GitHub Actionsでも、Pythonコードのフォーマットが正しいかテストをします。</p><p>GitHubリポジトリで、<code>Actions</code> -> <code>Set up a workflow yourself</code>を選択すると、GitHub Actionsの編集画面が表示されます。</p><p><img src=https://resources.yutaka0m.com/20200317163616.png alt></p><p>エディタに次のコードを書きます。</p><pre><code class=language-yaml>name: Python CI
on:
  push:
jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.7, 3.8]
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - name: Test with pytest
      run: |
        pip install pytest
        pytest
    - name: Test with black
      run: |
        pip install black
        black --check .
    - name: Test with flake8
      run: |
        pip install flake8
        flake8 . --statistics --count --show-source
    - name: Test with isort
      run: |
        pip install isort
        isort -c</code></pre><p>このGitHub Actionsは、GitHubにpushするたび、python3.7と3.8の環境で<code>pytest</code>, <code>black</code>, <code>flake8</code>, <code>isort</code>を実行します。プロジェクトにユニットテストがない場合は、<code>pytest</code>は不要です。</p><p>フォーマットが不正な場合は<code>Pull requests</code>の画面にテスト失敗したことが表示されます。これでコードレビューが捗ります。</p><p>このGitHub Actionsの設定は次のリポジトリで使っているのでご参考ください。</p><p><a href=https://github.com/yutaka0m/markdown-hiko>https://github.com/yutaka0m/markdown-hiko</a></p><h2 id=参考>参考</h2><ul><li><a href=https://github.com/yutaka0m/markdown-hiko>https://github.com/yutaka0m/markdown-hiko</a></li><li><a href=https://github.com/psf/black#pycharmintellij-idea>https://github.com/psf/black#pycharmintellij-idea</a></li><li><a href=https://help.github.com/ja/actions/getting-started-with-github-actions/about-github-actions>https://help.github.com/ja/actions/getting-started-with-github-actions/about-github-actions</a></li></ul></article></div></div></div></main><footer class=footer><div class="ax-l-i max-w-6xl"><nav class="flex items-center justify-center"><a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/entry/>記事一覧</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/about/>About</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/contact/>Contact</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/privacy-policy/>Privacy</a></nav><div class="footer-social flex items-center justify-center mt-4"><a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target=_blank rel="noopener nofollow" title=Twitter href=https://twitter.com/yutaka0m/><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11.0 01-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56.0 00-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57.0 002.914 5.452 6.48 6.48.0 01-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42.0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18.0 01-8.134 2.798c-.538.0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072.0 18.672-10 18.672-18.668.0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a><a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target=_blank rel="noopener nofollow" title=Github href=https://github.com/yutaka0m/><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M15.998.0C7.164.0.0 7.35.0 16.417.0 23.67 4.584 29.82 10.944 31.994c.8.15 1.092-.356 1.092-.79l-.022-2.792c-4.45.99-5.4-2.202-5.4-2.202-.726-1.896-1.776-2.4-1.776-2.4-1.454-1.018.108-.998.108-.998 1.606.117 2.45 1.693 2.45 1.693 1.428 2.507 3.746 1.784 4.658 1.363.144-1.06.558-1.784 1.016-2.195-3.552-.415-7.288-1.823-7.288-8.113.0-1.792.624-3.258 1.648-4.406-.166-.415-.714-2.085.156-4.344.0.0 1.344-.44 4.4 1.683 1.276-.364 2.644-.546 4.006-.552a14.98 14.98.0 014.006.554C23.062 6.37 24.404 6.8 24.404 6.8c.872 2.26.324 3.93.16 4.344 1.026 1.148 1.644 2.614 1.644 4.406.0 6.306-3.74 7.694-7.304 8.1.574.507 1.086 1.51 1.086 3.04l-.02 4.503c0 .44.288.95 1.1.788C27.42 29.817 32 23.667 32 16.417 32 7.35 24.836.0 15.998.0z"/></svg></a></div><div class="footer-copyright text-sm text-center text-gray-500 mt-4">&#169; 2020-2021 yutaka0m blog</div><div class="text-sm sm:text-xs text-center text-gray-500 mt-2">Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a></div></div></footer><script src="/bundle.js?v=1613303645"></script></body></html>
<!doctype html><html lang=jp-ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=hugo-theme content="Axiom 0.7.0"><link rel=icon href=https://resources.yutaka0m.com/favicon.ico><link rel=apple-touch-icon href=/image/brand/icon-1-1.jpg><link rel=canonical href=https://tech.yutaka0m.com/entry/2020/04/06/215/><link rel=preload as=style href="/bundle.css?v=1613305652" media=all><link rel=stylesheet href="/bundle.css?v=1613305652" media=all><style>.cdata pre{color:#edf2f7;background-color:#2d3748}.cdata :not(pre)>code{color:#805ad5;background-color:#f7fafc}.chroma .err{color:#fed7d7;background-color:#9b2c2c}.chroma .hl{background-color:#4a5568}.chroma .ln{color:#a0aec0}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#63b3ed}.chroma .kt{color:#b794f4}.chroma .na{color:#f6e05e}.chroma .nb{color:#f6ad55}.chroma .nc{color:#fc8181}.chroma .no{color:#68d391}.chroma .nd{color:#fc8181}.chroma .ne{color:#fc8181}.chroma .nf{color:#f6ad55}.chroma .nt{color:#fc8181}.chroma .l{color:#b794f4}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#68d391}.chroma .se{color:#a0aec0}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#68d391}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#b794f4}.chroma .o,.chroma .ow{color:#90cdf4}.chroma .p{color:#cbd5e0}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs{color:#a0aec0}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}</style><title>Terraformの実行を自動化する Atlantisの解説 : yutaka0m blog</title><meta property="og:title" content="Terraformの実行を自動化する Atlantisの解説"><meta property="og:site_name" content="yutaka0m blog"><meta property="og:url" content="https://tech.yutaka0m.com/entry/2020/04/06/215/"><link rel=image_src href=https://tech.yutaka0m.com/image/top-image.jpg><meta property="og:image" content="https://tech.yutaka0m.com/image/top-image.jpg"><meta property="og:image:width" content="1920"><meta property="og:image:height" content="1080"><meta property="og:type" content="article"><meta property="og:locale" content="jp_ja"><meta property="og:description" content="Atlantisは、TerraformのPull Requestをフックにして、自動的にplanやapplyをしてくれるソリューションです。 すごく便利です！ 対応している条件 Git Host 対応している、Gitホストは次のとおりです。  GitHub GitLab Bitbucket Cloud aka bitbucket.org Bitbucket Server aka Stash Azure DevOps  フォルダ構造  フラットなフォルダ構造 projectごとに分けられたフォルダ Moduleを使ったフォルダ構造  など、主に使うフォルダ構造には対応しています。 その他  .tfvars files 複数のリポジトリを管理すること Terraform Workspaces  などに対応しています。 GitHubへのアクセス方法 AtlantisからGitHubにアクセスするには、repo権限のTokenが必要です。 複数人で使用する場合は、自分のアカウントではなく、@atlantisのような新しいユーザを作成して、そのTokenを使用するとよいでしょう。"><meta name=description content="Atlantisは、TerraformのPull Requestをフックにして、自動的にplanやapplyをしてくれるソリューションです。 すごく便利です！ 対応している条件 Git Host 対応している、Gitホストは次のとおりです。  GitHub GitLab Bitbucket Cloud aka bitbucket.org Bitbucket Server aka Stash Azure DevOps  フォルダ構造  フラットなフォルダ構造 projectごとに分けられたフォルダ Moduleを使ったフォルダ構造  など、主に使うフォルダ構造には対応しています。 その他  .tfvars files 複数のリポジトリを管理すること Terraform Workspaces  などに対応しています。 GitHubへのアクセス方法 AtlantisからGitHubにアクセスするには、repo権限のTokenが必要です。 複数人で使用する場合は、自分のアカウントではなく、@atlantisのような新しいユーザを作成して、そのTokenを使用するとよいでしょう。"><meta property="og:updated_time" content="2020-04-06T09:00:34Z"><meta property="fb:app_id" content><meta name=author content="yutaka0m"><meta property="article:author" content="https://tech.yutaka0m.com"><meta property="article:published_time" content="2020-04-06T09:00:34Z"><meta property="article:modified_time" content="2020-04-06T09:00:34Z"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"Terraformの実行を自動化する Atlantisの解説","alternativeHeadline":"Atlantisは、TerraformのPull Requestをフックにして、自動的にplanやapplyをしてくれるソリューションです。 すごく便利です！ 対応している条件 Git Host 対応している、Gitホストは次のとおりです。  GitHub GitLab Bitbucket Cloud aka bitbucket.org Bitbucket Server aka Stash Azure DevOps  フォルダ構造  フラットなフォルダ構造 projectごとに分けられたフォルダ Moduleを使ったフォルダ構造  など、主に使うフォルダ構造には対応しています。 その他  .tfvars files 複数のリポジトリを管理すること Terraform Workspaces  などに対応しています。 GitHubへのアクセス方法 AtlantisからGitHubにアクセスするには、repo権限のTokenが必要です。 複数人で使用する場合は、自分のアカウントではなく、@atlantisのような新しいユーザを作成して、そのTokenを使用するとよいでしょう。","url":"https://tech.yutaka0m.com/entry/2020/04/06/215/","image":"https://tech.yutaka0m.com/image/top-image.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://tech.yutaka0m.com/entry/2020/04/06/215/"},"description":"Atlantisは、TerraformのPull Requestをフックにして、自動的にplanやapplyをしてくれるソリューションです。 すごく便利です！ 対応している条件 Git Host 対応している、Gitホストは次のとおりです。  GitHub GitLab Bitbucket Cloud aka bitbucket.org Bitbucket Server aka Stash Azure DevOps  フォルダ構造  フラットなフォルダ構造 projectごとに分けられたフォルダ Moduleを使ったフォルダ構造  など、主に使うフォルダ構造には対応しています。 その他  .tfvars files 複数のリポジトリを管理すること Terraform Workspaces  などに対応しています。 GitHubへのアクセス方法 AtlantisからGitHubにアクセスするには、repo権限のTokenが必要です。 複数人で使用する場合は、自分のアカウントではなく、@atlantisのような新しいユーザを作成して、そのTokenを使用するとよいでしょう。","author":{"@type":"Person","name":"yutaka0m"},"publisher":{"@type":"Organization","name":"yutaka0m blog","logo":{"@type":"ImageObject","url":"https://tech.yutaka0m.com/image/brand/icon-1-1.jpg"}},"datePublished":"2020-04-06T09:00:34Z","dateModified":"2020-04-06T09:00:34Z","articleBody":"\u003cp\u003e\u003ca href=\"https://www.runatlantis.io/\"\u003eAtlantis\u003c/a\u003eは、TerraformのPull Requestをフックにして、自動的に\u003ccode\u003eplan\u003c/code\u003eや\u003ccode\u003eapply\u003c/code\u003eをしてくれるソリューションです。\u003c/p\u003e\u003c/p\u003e\n\u003cp\u003eすごく便利です！\u003c/p\u003e\n\u003ch2 id=\"対応している条件\"\u003e対応している条件\u003c/h2\u003e\n\u003ch3 id=\"git-host\"\u003eGit Host\u003c/h3\u003e\n\u003cp\u003e対応している、Gitホストは次のとおりです。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eGitHub\u003c/li\u003e\n\u003cli\u003eGitLab\u003c/li\u003e\n\u003cli\u003eBitbucket Cloud aka bitbucket.org\u003c/li\u003e\n\u003cli\u003eBitbucket Server aka Stash\u003c/li\u003e\n\u003cli\u003eAzure DevOps\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"フォルダ構造\"\u003eフォルダ構造\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eフラットなフォルダ構造\u003c/li\u003e\n\u003cli\u003eprojectごとに分けられたフォルダ\u003c/li\u003e\n\u003cli\u003eModuleを使ったフォルダ構造\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eなど、主に使うフォルダ構造には対応しています。\u003c/p\u003e\n\u003ch3 id=\"その他\"\u003eその他\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e.tfvars files\u003c/li\u003e\n\u003cli\u003e複数のリポジトリを管理すること\u003c/li\u003e\n\u003cli\u003eTerraform Workspaces\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eなどに対応しています。\u003c/p\u003e\n\u003ch2 id=\"githubへのアクセス方法\"\u003eGitHubへのアクセス方法\u003c/h2\u003e\n\u003cp\u003eAtlantisからGitHubにアクセスするには、repo権限のTokenが必要です。\u003c/p\u003e\n\u003cp\u003e複数人で使用する場合は、自分のアカウントではなく、\u003ccode\u003e@atlantis\u003c/code\u003eのような新しいユーザを作成して、そのTokenを使用するとよいでしょう。\u003c/p\u003e\n\u003cp\u003eそれ以外のGitホストも、Tokenを使ってアクセスします。\u003c/p\u003e\n\u003cp\u003eGitHubのpushなどのイベントをAtlantisに通知するには、Webhookに設定が必要です。Atlantisは、\u003ccode\u003eWebhook Secret\u003c/code\u003eに対応しているので、セキュリティのため設定することをオススメします。\u003c/p\u003e\n\u003cp\u003eランダムなシークレットは、\u003ca href=\"https://www.random.org/passwords/?num=2\u0026amp;len=24\u0026amp;format=html\u0026amp;rnd=new\"\u003eRANDOM.ORG\u003c/a\u003eで生成できます。\u003c/p\u003e\n\u003ch3 id=\"atlantisの実行環境\"\u003eAtlantisの実行環境\u003c/h3\u003e\n\u003cp\u003eAtlantisはGo言語で書かれています。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eKubernetes\u003c/li\u003e\n\u003cli\u003eOpenShift\u003c/li\u003e\n\u003cli\u003eDocker\u003c/li\u003e\n\u003cli\u003eバイナリ実行\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eなどの実行環境で動作します。\u003c/p\u003e\n\u003cp\u003e次のようなマネージドサービスを使用することもできます。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAWS Fargate\u003c/li\u003e\n\u003cli\u003eGoogle Kubernetes Engine\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"githubwebhookの設定\"\u003eGitHubWebhookの設定\u003c/h3\u003e\n\u003cp\u003eAtlantisがGitHubのPRイベントに応答できるように、Webhookの設定をする必要があります。\u003c/p\u003e\n\u003cp\u003eGitHub:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eリポジトリトップ\u003c/code\u003e -\u0026gt; \u003ccode\u003eSettings\u003c/code\u003e -\u0026gt; \u003ccode\u003eWebhooks\u003c/code\u003e -\u0026gt; \u003ccode\u003eAdd webhook\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePayload URL : \u003ccode\u003ehttp://${Atlantisのホスト名}/events\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eContent type : application/json\u003c/li\u003e\n\u003cli\u003eSecret : Atlantisに設定するシークレットと同じものを設定する\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"設定\"\u003e設定\u003c/h2\u003e\n\u003ch3 id=\"サーバ側の設定\"\u003eサーバ側の設定\u003c/h3\u003e\n\u003cp\u003eサーバ側に設置された\u003ccode\u003eyaml\u003c/code\u003eファイルによって、サーバ側の設定を記述できます。\u003c/p\u003e\n\u003cp\u003eサーバ側の設定を有効にするには、たとえば\u003ccode\u003erepos.yaml\u003c/code\u003eというファイルを作成します。\u003ccode\u003eatlantis server\u003c/code\u003eコマンドで、\u003ccode\u003e--repo-config=path/to/repos.yaml\u003c/code\u003eと指定します。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePRがApproveされないとApplyできない\u003c/li\u003e\n\u003cli\u003ePRがマージ可能な状態でないとApplyできない\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eなどの設定をすることできます。\u003c/p\u003e\n\u003cp\u003e詳しい設定方法は、\u003ca href=\"https://www.runatlantis.io/docs/server-side-repo-config.html\"\u003eServer Side Repo Config – Atlantis\u003c/a\u003e に記述されています。\u003c/p\u003e\n\u003ch3 id=\"カスタムワークフロー\"\u003eカスタムワークフロー\u003c/h3\u003e\n\u003cp\u003eatlantisで\u003ccode\u003eplan\u003c/code\u003eや\u003ccode\u003eapply\u003c/code\u003eする際に、特殊な処理をしたい場合は、カスタムワークフローを使用します。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eplan\u003c/code\u003eの引数を追加したり、任意のスクリプトを実行できたりします。\u003c/p\u003e\n\u003cp\u003e詳しい設定方法は、\u003ca href=\"https://www.runatlantis.io/docs/custom-workflows.html\"\u003eCustom Workflows – Atlantis\u003c/a\u003e に記述されています。\u003c/p\u003e\n\u003ch3 id=\"リポジトリ側の設定\"\u003eリポジトリ側の設定\u003c/h3\u003e\n\u003cp\u003eリポジトリに設置された\u003ccode\u003eatlantis.yaml\u003c/code\u003eファイルによって、リポジトリごとのAtlantis設定を記述できます。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e自動で\u003ccode\u003eplan\u003c/code\u003eを実行することを停止する\u003c/li\u003e\n\u003cli\u003eTerraform Workspacesの設定\u003c/li\u003e\n\u003cli\u003eTerraformバージョンの指定\u003c/li\u003e\n\u003cli\u003e指定の環境だけ、Approveを必須にする\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eなどの設定ができます。\u003c/p\u003e\n\u003ch2 id=\"その他-1\"\u003eその他\u003c/h2\u003e\n\u003cp\u003eAtlantisには、ロッキングの機能があります。\u003c/p\u003e\n\u003cp\u003eすでに\u003ccode\u003eplan\u003c/code\u003eコマンドを実行しているPRがある場合は、そのPRがマージされるまで、他のPRで\u003ccode\u003eplan\u003c/code\u003eや\u003ccode\u003eapply\u003c/code\u003eができなくなります。\u003c/p\u003e\n\u003cp\u003eこれは、同時実行によって、予期せぬ変更が加えられてしまうことを防止するための機能です。\u003c/p\u003e\n\u003ch2 id=\"まとめ\"\u003eまとめ\u003c/h2\u003e\n\u003cp\u003eTerraformの自動実行でやりたいことは、ほとんどAtlantisの標準機能でまかなえそうです。\u003c/p\u003e\n\u003cp\u003eどうしても追加の処理が必要だったら、カスタムワークフローでスクリプトを実行することもできます。\u003c/p\u003e"}</script><link rel=preload as=script href="/bundle.js?v=1613305652"></head><body><header id=nav class=header><div class="ax-l-i max-w-6xl"><div class=ax-logo><a class=block href=/ title="yutaka0m blog"><span class="font-semibold text-raven-900">yutaka0m blog</span></a></div><div class=ax-user><a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target=_blank rel="noopener nofollow" href="https://www.google.com/search?q=site:https://tech.yutaka0m.com" title=Search><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33.0 002.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg></a><a class="p-2 block text-base leading-none text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" href=/entry/>記事一覧</a></div></div></header><main><div class=default-single><div class="ax-title ax-l-o"><div class="ax-l-i max-w-680"><h1 class="post-title font-content-title font-normal leading-tight tracking-default text-40">Terraformの実行を自動化する Atlantisの解説</h1><div class="ax-meta flex items-center mt-5"><div class="flex-grow min-w-0"><div class="flex items-center"><div class=flex-shrink-0><img class="w-12 h-12 sm:w-14 sm:h-14 object-cover p-3px rounded-full border border-blue-300" src=/image/author/default.jpg alt=yutaka0m></div><div class="flex-shrink-0 ml-2 leading-tight font-content-sans"><a class="block text-sm text-raven-800 hover:text-raven-900 hover:underline focus:underline" target=_blank rel="noopener nofollow" title=yutaka0m href=https://tech.yutaka0m.com>yutaka0m</a>
<time class="text-sm text-raven-500" datetime=2020-04-06T09:00:34Z>Apr 6, 2020 9:00AM</time></div></div></div><div><div class="flex items-center"><a class="flex-shrink-0 block text-raven-800 hover:text-raven-900" target=_blank rel="noopener nofollow" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Terraform%e3%81%ae%e5%ae%9f%e8%a1%8c%e3%82%92%e8%87%aa%e5%8b%95%e5%8c%96%e3%81%99%e3%82%8b%20Atlantis%e3%81%ae%e8%a7%a3%e8%aa%ac%20by%20%40yutaka0m%20https%3a%2f%2ftech.yutaka0m.com%2fentry%2f2020%2f04%2f06%2f215%2f"><svg class="w-6 h-6 fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11.0 01-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56.0 00-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57.0 002.914 5.452 6.48 6.48.0 01-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42.0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18.0 01-8.134 2.798c-.538.0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072.0 18.672-10 18.672-18.668.0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a><a class="ml-3 flex-shrink-0 block text-raven-800 hover:text-raven-900" target=_blank rel="noopener nofollow" title="Share on Facebook" href="https://www.facebook.com/dialog/share?app_id=&display=page&href=https%3a%2f%2ftech.yutaka0m.com%2fentry%2f2020%2f04%2f06%2f215%2f"><svg class="w-6 h-6 fill-current" viewBox="-7 -3.5 39 39" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M30.234.0H1.765C.8.001.0.79.0 1.766v28.47C.001 31.2.79 32 1.766 32h15.328V19.625h-4.156V14.78h4.156v-3.564c0-4.134 2.523-6.384 6.21-6.384 1.766.0 3.284.13 3.726.2v4.32h-2.543c-2.006.0-2.394.953-2.394 2.352v3.085h4.797l-.625 4.844h-4.172V32h8.14C31.21 32 32 31.2 32 30.234V1.765C32 .8 31.21.0 30.234.0z"/></svg></a></div></div></div></div></div><div class="ax-content ax-l-o"><div class="ax-l-i max-w-680"><article class=cdata><p><a href=https://www.runatlantis.io/>Atlantis</a>は、TerraformのPull Requestをフックにして、自動的に<code>plan</code>や<code>apply</code>をしてくれるソリューションです。</p></p><p>すごく便利です！</p><h2 id=対応している条件>対応している条件</h2><h3 id=git-host>Git Host</h3><p>対応している、Gitホストは次のとおりです。</p><ul><li>GitHub</li><li>GitLab</li><li>Bitbucket Cloud aka bitbucket.org</li><li>Bitbucket Server aka Stash</li><li>Azure DevOps</li></ul><h3 id=フォルダ構造>フォルダ構造</h3><ul><li>フラットなフォルダ構造</li><li>projectごとに分けられたフォルダ</li><li>Moduleを使ったフォルダ構造</li></ul><p>など、主に使うフォルダ構造には対応しています。</p><h3 id=その他>その他</h3><ul><li>.tfvars files</li><li>複数のリポジトリを管理すること</li><li>Terraform Workspaces</li></ul><p>などに対応しています。</p><h2 id=githubへのアクセス方法>GitHubへのアクセス方法</h2><p>AtlantisからGitHubにアクセスするには、repo権限のTokenが必要です。</p><p>複数人で使用する場合は、自分のアカウントではなく、<code>@atlantis</code>のような新しいユーザを作成して、そのTokenを使用するとよいでしょう。</p><p>それ以外のGitホストも、Tokenを使ってアクセスします。</p><p>GitHubのpushなどのイベントをAtlantisに通知するには、Webhookに設定が必要です。Atlantisは、<code>Webhook Secret</code>に対応しているので、セキュリティのため設定することをオススメします。</p><p>ランダムなシークレットは、<a href="https://www.random.org/passwords/?num=2&len=24&format=html&rnd=new">RANDOM.ORG</a>で生成できます。</p><h3 id=atlantisの実行環境>Atlantisの実行環境</h3><p>AtlantisはGo言語で書かれています。</p><ul><li>Kubernetes</li><li>OpenShift</li><li>Docker</li><li>バイナリ実行</li></ul><p>などの実行環境で動作します。</p><p>次のようなマネージドサービスを使用することもできます。</p><ul><li>AWS Fargate</li><li>Google Kubernetes Engine</li></ul><h3 id=githubwebhookの設定>GitHubWebhookの設定</h3><p>AtlantisがGitHubのPRイベントに応答できるように、Webhookの設定をする必要があります。</p><p>GitHub:</p><p><code>リポジトリトップ</code> -> <code>Settings</code> -> <code>Webhooks</code> -> <code>Add webhook</code></p><ul><li>Payload URL : <code>http://${Atlantisのホスト名}/events</code></li><li>Content type : application/json</li><li>Secret : Atlantisに設定するシークレットと同じものを設定する</li></ul><h2 id=設定>設定</h2><h3 id=サーバ側の設定>サーバ側の設定</h3><p>サーバ側に設置された<code>yaml</code>ファイルによって、サーバ側の設定を記述できます。</p><p>サーバ側の設定を有効にするには、たとえば<code>repos.yaml</code>というファイルを作成します。<code>atlantis server</code>コマンドで、<code>--repo-config=path/to/repos.yaml</code>と指定します。</p><ul><li>PRがApproveされないとApplyできない</li><li>PRがマージ可能な状態でないとApplyできない</li></ul><p>などの設定をすることできます。</p><p>詳しい設定方法は、<a href=https://www.runatlantis.io/docs/server-side-repo-config.html>Server Side Repo Config – Atlantis</a> に記述されています。</p><h3 id=カスタムワークフロー>カスタムワークフロー</h3><p>atlantisで<code>plan</code>や<code>apply</code>する際に、特殊な処理をしたい場合は、カスタムワークフローを使用します。</p><p><code>plan</code>の引数を追加したり、任意のスクリプトを実行できたりします。</p><p>詳しい設定方法は、<a href=https://www.runatlantis.io/docs/custom-workflows.html>Custom Workflows – Atlantis</a> に記述されています。</p><h3 id=リポジトリ側の設定>リポジトリ側の設定</h3><p>リポジトリに設置された<code>atlantis.yaml</code>ファイルによって、リポジトリごとのAtlantis設定を記述できます。</p><ul><li>自動で<code>plan</code>を実行することを停止する</li><li>Terraform Workspacesの設定</li><li>Terraformバージョンの指定</li><li>指定の環境だけ、Approveを必須にする</li></ul><p>などの設定ができます。</p><h2 id=その他-1>その他</h2><p>Atlantisには、ロッキングの機能があります。</p><p>すでに<code>plan</code>コマンドを実行しているPRがある場合は、そのPRがマージされるまで、他のPRで<code>plan</code>や<code>apply</code>ができなくなります。</p><p>これは、同時実行によって、予期せぬ変更が加えられてしまうことを防止するための機能です。</p><h2 id=まとめ>まとめ</h2><p>Terraformの自動実行でやりたいことは、ほとんどAtlantisの標準機能でまかなえそうです。</p><p>どうしても追加の処理が必要だったら、カスタムワークフローでスクリプトを実行することもできます。</p></article></div></div></div></main><footer class=footer><div class="ax-l-i max-w-6xl"><nav class="flex items-center justify-center"><a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/entry/>記事一覧</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/about/>About</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/contact/>Contact</a>
<a class="ml-3 first:ml-0 text-sm text-gray-600 hover:text-gray-800" href=/privacy-policy/>Privacy</a></nav><div class="footer-social flex items-center justify-center mt-4"><a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target=_blank rel="noopener nofollow" title=Twitter href=https://twitter.com/yutaka0m/><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M32 6.078c-1.2.522-2.458.868-3.78 1.036 1.36-.812 2.398-2.088 2.886-3.626a13.11 13.11.0 01-4.16 1.588C25.742 3.794 24.026 3 22.154 3a6.56 6.56.0 00-6.556 6.562c0 .52.044 1.02.152 1.496-5.454-.266-10.28-2.88-13.522-6.862-.566.982-.898 2.106-.898 3.316a6.57 6.57.0 002.914 5.452 6.48 6.48.0 01-2.964-.808v.072c0 3.188 2.274 5.836 5.256 6.446-.534.146-1.116.216-1.72.216-.42.0-.844-.024-1.242-.112.85 2.598 3.262 4.508 6.13 4.57a13.18 13.18.0 01-8.134 2.798c-.538.0-1.054-.024-1.57-.1C2.906 27.93 6.35 29 10.064 29c12.072.0 18.672-10 18.672-18.668.0-.3-.01-.57-.024-.848C30.014 8.56 31.108 7.406 32 6.078z"/></svg></a><a class="block mx-3 w-6 h-6 text-raven-700 hover:text-raven-900" target=_blank rel="noopener nofollow" title=Github href=https://github.com/yutaka0m/><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M15.998.0C7.164.0.0 7.35.0 16.417.0 23.67 4.584 29.82 10.944 31.994c.8.15 1.092-.356 1.092-.79l-.022-2.792c-4.45.99-5.4-2.202-5.4-2.202-.726-1.896-1.776-2.4-1.776-2.4-1.454-1.018.108-.998.108-.998 1.606.117 2.45 1.693 2.45 1.693 1.428 2.507 3.746 1.784 4.658 1.363.144-1.06.558-1.784 1.016-2.195-3.552-.415-7.288-1.823-7.288-8.113.0-1.792.624-3.258 1.648-4.406-.166-.415-.714-2.085.156-4.344.0.0 1.344-.44 4.4 1.683 1.276-.364 2.644-.546 4.006-.552a14.98 14.98.0 014.006.554C23.062 6.37 24.404 6.8 24.404 6.8c.872 2.26.324 3.93.16 4.344 1.026 1.148 1.644 2.614 1.644 4.406.0 6.306-3.74 7.694-7.304 8.1.574.507 1.086 1.51 1.086 3.04l-.02 4.503c0 .44.288.95 1.1.788C27.42 29.817 32 23.667 32 16.417 32 7.35 24.836.0 15.998.0z"/></svg></a></div><div class="footer-copyright text-sm text-center text-gray-500 mt-4">&#169; 2020-2021 yutaka0m blog</div><div class="text-sm sm:text-xs text-center text-gray-500 mt-2">Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a></div></div></footer><script src="/bundle.js?v=1613305652"></script></body></html>